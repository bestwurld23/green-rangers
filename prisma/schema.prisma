// Green Rangers Database Schema
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id            String    @id @default(cuid())
  email         String    @unique
  name          String?
  role          UserRole  @default(JOB_SEEKER)
  createdAt     DateTime  @default(now())
  updatedAt     DateTime  @updatedAt

  profile       Profile?
  applications  Application[]
  savedJobs     SavedJob[]

  @@map("users")
}

enum UserRole {
  JOB_SEEKER
  EMPLOYER
  WORKFORCE_DEVELOPER
  ADMIN
}

model Profile {
  id              String   @id @default(cuid())
  userId          String   @unique
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  phone           String?
  location        String?
  bio             String?  @db.Text
  avatarUrl       String?

  title           String?
  yearsExperience Int?
  skills          String[]
  certifications  Certification[]

  portfolioUrl    String?
  linkedinUrl     String?
  resumeUrl       String?

  jobTypes        String[]
  desiredSalary   Int?
  willingToRelocate Boolean @default(false)

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@map("profiles")
}

model Certification {
  id          String   @id @default(cuid())
  profileId   String
  profile     Profile  @relation(fields: [profileId], references: [id], onDelete: Cascade)

  name        String
  issuer      String
  issuedDate  DateTime?
  expiryDate  DateTime?
  credentialId String?
  credentialUrl String?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@map("certifications")
}

model Job {
  id              String   @id @default(cuid())

  title           String
  company         String
  location        String
  description     String   @db.Text

  employmentType  String
  seniorityLevel  String?
  salary          String?
  remote          Boolean  @default(false)

  latitude        Float?
  longitude       Float?

  postLink        String?
  companyUrl      String?

  skills          String[]
  certifications  String[]

  source          String   @default("manual")
  externalId      String?
  isActive        Boolean  @default(true)
  postedDate      DateTime?

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  applications    Application[]
  savedBy         SavedJob[]

  @@index([location])
  @@index([employmentType])
  @@index([isActive])
  @@map("jobs")
}

model Application {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  jobId       String
  job         Job      @relation(fields: [jobId], references: [id], onDelete: Cascade)

  status      ApplicationStatus @default(PENDING)
  coverLetter String?  @db.Text
  notes       String?  @db.Text

  appliedAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([userId, jobId])
  @@map("applications")
}

enum ApplicationStatus {
  PENDING
  REVIEWING
  INTERVIEWED
  OFFERED
  REJECTED
  ACCEPTED
  WITHDRAWN
}

model SavedJob {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  jobId     String
  job       Job      @relation(fields: [jobId], references: [id], onDelete: Cascade)

  savedAt   DateTime @default(now())

  @@unique([userId, jobId])
  @@map("saved_jobs")
}

model CrewRequest {
  id            String   @id @default(cuid())

  name          String
  email         String
  phone         String
  company       String?

  location      String
  projectDate   DateTime
  crewSize      Int
  projectType   String
  description   String?  @db.Text

  status        CrewRequestStatus @default(PENDING)
  estimatedCost Int

  notes         String?  @db.Text

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([projectDate])
  @@index([status])
  @@map("crew_requests")
}

enum CrewRequestStatus {
  PENDING
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
}

model LaborerApplication {
  id                   String   @id @default(cuid())

  name                 String
  email                String
  phone                String
  location             String

  experience           String   @db.Text
  credentials          String?  @db.Text
  vision               String   @db.Text
  availability         String

  resumeUrl            String?

  reference1Name       String
  reference1Phone      String
  reference1Relationship String

  reference2Name       String
  reference2Phone      String
  reference2Relationship String

  status               LaborerApplicationStatus @default(PENDING)
  notes                String?  @db.Text

  createdAt            DateTime @default(now())
  updatedAt            DateTime @updatedAt

  @@index([status])
  @@index([email])
  @@map("laborer_applications")
}

enum LaborerApplicationStatus {
  PENDING
  REVIEWING
  INTERVIEWED
  APPROVED
  REJECTED
  HIRED
}
